#{extends 'main.html' /}
#{set title:'Onderzoek' /}

<script type="text/javascript" src="@{'/public/javascripts/swfobject.js'}"></script>

<body class="yui-skin-sam">
<div id="doc4" class="yui-t3">
  <!--<div id="hd" role="banner"><h1>Header</h1></div>-->

  <div id="bd" role="contentinfo">
    <div id="yui-main">
      <div class="yui-b">
        <div role="application" class="yui-g">
	<!-- YOUR DATA GOES HERE -->
          <div id="video">
            You need Flash and stuff
          </div>
        </div>
      </div>
    </div>
    <div role="navigation" class="yui-b">
    <!-- YOUR NAVIGATION GOES HERE -->
      <br/>
      #{testscale name:'Intelligentie', label:'intelligentie' /}
      #{testscale name:'Commercieel inzicht', label:'commercieelInzicht' /}
      #{testscale name:'Verkoopvaardigheden', label:'verkoopVaardigheden' /}
      #{testscale name:'Onderhandelen', label:'onderhandelen' /}
      #{testscale name:'Productkennis', label:'productKennis' /}
      #{testscale name:'Klantgerichtheid', label:'klantGerichtheid' /}
      #{testscale name:'Communicatieve vaardigheid', label:'communicatieveVaardigheid' /}
      #{testscale name:'Openheid', label:'openheid' /}
      #{testscale name:'ConsciÃ«ntieusheid', label:'conscientieusheid' /}
      #{testscale name:'Extraversie', label:'extraversie' /}
      #{testscale name:'Aangenaamheid', label:'aangenaamheid' /}
      #{testscale name:'Neuroticisme', label:'neuroticisme' /}
      #{testscale name:'Eerlijkheid', label:'eerlijkheid' /}
    </div>
  </div>
  <!--<div id="footer"><p>Footer</p></div>-->
</div>

<br/>
<textarea id="output" cols="100" rows="5"></textarea> 

</body>
</html>

<script type="text/javascript">
  var params = { allowScriptAccess: "always" };
  var atts = { id: "player" };
  swfobject.embedSWF("http://www.youtube.com/v/SBjQ9tuuTJQ?enablejsapi=1&playerapiid=apiplayer&version=3&controls=0&disablekb=1&showinfo=0", "video", "425", "356", "8", null, null, params, atts);
</script>

<script type="text/javascript">
  var player = {
    getPlayerState: function() {
      return 1;
    },

    pauseVideo: function() {
      return;
    },

    getCurrentTime: function() {
      return 02;
    }
};

  unfreezeAllOpenQuestions();

  $('a').click(function(event) {
    event.preventDefault();
  });

  $('.likertscale > input:radio').click(function() {
    var time = player.getCurrentTime();
    var radioButton = $(this);
    var chosenValue = radioButton.attr('value');
    var scaleName = radioButton.attr('name');
    
    storeAssessment(scaleName, chosenValue, time);
    printAssessment(scaleName, chosenValue, time);
     
    var likertElement = radioButton.parent('.likertscale');
    likertElement.addClass('blocked');
    $(likertElement).click(function(event) {
      event.preventDefault();
    });
    
    var questionElement = likertElement.parent('.question');
    questionElement.removeClass('open');
    questionElement.unbind('click');
    radioButton.unbind('click');
    radioButton.siblings().unbind('click');
   
    unfreezeAllOpenQuestions(); 
    resumePlayer();
  });
  
  function attentionToQuestion(questionElement) {
    if (!playing()) {
      return;
    }
    console.log("attention shifts to " + $(questionElement.children('h3')[0]).text());
    pausePlayer();
    freezeAllQuestions();
    questionElement.find('.likertscale').removeClass('disabled');
  }

  function freezeAllQuestions() {
    console.log("freezing");
    var questions = $('.question');
    
    // make unclickable, both functionally and from a user perspective
    questions.css('cursor', 'text');
    questions.unbind('click'); 
  }

  function unfreezeAllOpenQuestions() {
    console.log("unfreezing");
    var openQuestions = $('.question').filter('.open');

    // make clickable, both functionally and from a user perspective
    openQuestions.css('cursor', 'auto');
    openQuestions.click(function() {
      attentionToQuestion($(this));
    });
  }

  function onYouTubePlayerReady(playerId) {
    console.log('playah ready with id ' + playerId);
    player = document.getElementById('player');
  }

  function pausePlayer() {
    if (playing()) {
      player.pauseVideo();
    }
  }
  
  function resumePlayer() {
    if (paused()) {
      player.playVideo();
    }
  }

  function playing() {
    return player.getPlayerState() === 1; // playing
  }

  function paused() {
    return player.getPlayerState() === 2; // paused
  }

  function storeAssessment(scale, value, passedTime) {
    console.log("storing assessment data");
    $.ajax({
      type: 'POST',
      url: 'interview/assessment',
      data: {scaleLabel: scale, value: value, time: passedTime},
      success: function(){ console.log("data stored with success"); },
      dataType: 'text'
    });
  }

  function printAssessment(scale, value, passedTime) {
    var lineBreak = "\n";
    var outputBox = $('#output');
    var existingText = outputBox.val();
    
    if (existingText.length == 0) {
      lineBreak = "";
    }
    outputBox.val(existingText + lineBreak + "Proefpersoon heeft " + value + " gekozen op de schaal " + scale + " (na " + passedTime + " seconden).");
  }
</script>
